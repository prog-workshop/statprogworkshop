---
title: Clinical Report with R II
subtitle: A Shiny App for Fast Statistical Analysis
author: Tao Xiang
date: 2026-01-23
format: 
  revealjs:
    theme: [default, title-style.scss]
    smaller: true
    scrollable: true
    chalkboard: true
    logo: assets/footlogo.png
    include-in-header:
      - text: |
          <script src="highlight.pack.js"></script>
          <script>hljs.initHighlightingOnLoad();</script>
    css: styles/vs.css
    template-partials:
        - revealjs-assets/title-slide.html
revealjs-plugins:
  - pointer
execute: 
  echo: true
  eval: false
---

## Agenda

-   Background and Introduction

-   App Development and how to use

-   Live Demo and Discussion

---

<div class="appendix-title-container">
  <div class="appendix-title">Background and Introduction</div>
</div>

## Backgroud of development

["Clinical Report with R"](https://statprogworkshop.onrender.com/Clinical%20Report%20with%20R/Clinical_Report_With_R.html) is on of workshop I made in summer of 2024. The core is developing TFL workflow in R, which is a migration from our SAS workflow to R. However, comparing with common programming method to generate TFL, more efficient, automatical visualization tool is desired by our department. So, I turned to another powerful solution, **R Shiny**.

## Introduction to R Shiny

Shiny is an R package that makes it easy to build interactive web applications (apps) straight from R without any frontend knowledge(HTML, CSS, or JavaScript).

![](imgs/shiny-thumb.png){width="124"}

```{r}
install.packages("shiny")
```

## Components of Shiny app

1.  The **UI** (short for user interface) which defines how your app looks
2.  The **server** function which defines how your app works

```{r}
library(shiny)
ui <- fluidPage(
  "Hello, world!"
)
server <- function(input, output, session) {
}
shinyApp(ui, server)
```

## What we need from Shiny app

::: {.fragment .fade-in-then-out}
- Replace SAS/Viya VA/JMP?

- Give a nice appearance to SAS macros?

- Compete with other tools?
:::

::: {.fragment .fade-up style="margin-top: 200px; font-size: 3em; color: red;"}
Nah
:::


## Purpose of development

1. Improve Efficiency

2. Standardized Workflow

3. For the whole team

4. Reproducibility and Traceability

5. Low cost of app development

## What is `teal`?

- A RShiny-based interactive data exploration framework

- Modularized and standardized building blocks

- Collection of specialized R packages

- Streamlines creation of web-apps that offers:

  - Dynamic filtering facility
  - Code reproducibility
  - Reporting engine
  - Many data summarization and visualizations

## Traditional Shiny App

```{R}
#| echo: false
#| eval: true
DiagrammeR::grViz("digraph {

graph [layout = dot, rankdir = LR]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

Datasets [label =  'Data \n Datasets 1 \n Datasets 2 \n Datasets 3']
Shiny [label = 'Shiny \n ui \n server', shape = folder, fillcolor = Pink]

# edge definitions with the node IDs

Datasets ->Shiny

}")
```

## teal workflow

```{R}
#| echo: false
#| eval: true
DiagrammeR::grViz("digraph {

graph [layout = dot, rankdir = LR]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

Datasets1 [label =  'Datasets 1']
Datasets2 [label =  'Datasets 2']
Datasets3 [label =  'Datasets 3']
Module1 [label = 'Module 1 \n ui \n server', shape = ellipse, fillcolor = Beige]
Module2 [label = 'Module 2 \n ui \n server', shape = ellipse, fillcolor = Beige]
Module3 [label = 'Module 3 \n ui \n server', shape = ellipse, fillcolor = Beige]
teal [label = 'teal framework \n ui \n server', shape = folder, fillcolor = Pink]
app [label = 'Interactive App', fillcolor = Moccasin]

# edge definitions with the node IDs

Datasets1 -> Module1
Datasets2 -> Module2
Datasets3 -> Module3

{Module1 Module2 Module3} -> teal -> app

}")
```

## `teal` product map

![](imgs/product_map.png)

## Why choose `teal`?

Spending months on diving into open-source solutions to statistical analysis. I picked `teal` for app development baseline framework for the rest but not least reasons:

- `teal` is an interactive data exploration framework based on shiny, designed primarily to analyze **CDISC** clinical trial data

- `teal` framework provides application developers with a wide range of customizable standard analysis modules

- No need to spending a lot of time on UI/UX matters (Bootstrap V5 themes since `teal` v1.0.0) 

- Built by renowned Roche NEST project team, accepted and collaborated with multiple big pharma. (Sustained development)

- Rich source of help documents and examples.

## Challenges in development

- Rich source of help documents and examples, which also brought steep learning curve and burdens.

- Lack of Shiny basic knowledges.

- Reproducible R environment and continuous integration.

- AI performed not ideally in solving `teal` development problems.

## Actors

|Roles                        | Primary Responsibility  |
|-----------------------------|-------------------------|
| `teal` app user             | Use app to product statistical reports, all faculty in BIOS. R knowledges in not required. |
| `teal` app developer        | Create app from built functions from `teal` ecosystem. Need intermediate R skills like Basic, idyverse, Shiny, functional programming. Have to learn `teal` framework with bunch of resources.         |
| `teal` module developer     | Create customized modules on internal analysis purpose. Need a little advanced R knowledge. Understand reactive programming in Shiny, meta-programming for source development, familiar with table grammer packages like rtables, draw complex plot with `ggplot2`, rendering engine R packages for output, so and so forth.                     |
|  `teal` framework developer | Roche NEST project team and collaborators from other open-source developing team. Create and maintain this frameworks by those SDEs and data scientists. |

---

<div class="appendix-title-container">
  <div class="appendix-title">App Development and how to use</div>
</div>

## `teal4dv`

`teal4dv` is how I named this shiny app, created and modified from `teal` ecosystem designed and open sourced by Roche NEST Project. This app is developed for internal use by Innocare Biostat team, applied for statistical monitor and data visualization purpose.

This app (`teal4dv` v0.0.0.9000) is created for local use at beginning. We will figure out server deployment strategy in future.

![](imgs/hex-teal4dv.png)

## App Structure

It was created via `usethis::create_package()` to make this app a r-package like structure. App version is recorded in `DESCRIPTION` file.

```
teal4dv/
    ├── data/
    │   ├── adae.sas7bdat
    │   ├── adlb.sas7bdat
    │   ├── adrs.sas7bdat
    │   ├── adsl.sas7bdat
    │   ├── adtr.sas7bdat
    │   ├── adtte.sas7bdat
    ├── R/
    │   ├── table_with_setting_mod.R
    │   ├── tm_gmod_boxplot.R
    │   ├── tm_gmod_kmplot.R
    │   ├── tm_gmod_spider.R
    │   ├── tm_gmod_swim.R
    │   ├── tm_gmod_waterfall.R
    │   ├── tm_tmod_aesocpt_grade.R
    │   ├── tm_tmod_aesocpt.R
    │   ├── tm_tmod_aesum.R
    │   ├── tm_tmod_summary_bds.R
    │   ├── tm_tmod_summary.R
    │   ├── utils.R
    ├── renv/
    │   ├── .gitignore
    │   ├── activate.R
    │   └── settings.json
    ├── app.R
    ├── DESCRIPTION
    ├── renv.lock
    └── teal4dv.Rproj
```

## Resolve reproducible environment issues

- Require R >= 4.4.1

- The [renv](https://rstudio.github.io/renv/) package helps create reproducible environments for this project and make this app more isolated, portable and reproducible.

![](imgs/renv_flow.png)

## Install and running app

Make sure you have installed [renv](https://rstudio.github.io/renv/index.html) first:

```R
install.packages("renv")
```

Project Environment was isolated and reproducible via `renv`. Restore the enviroment for package dependencies each time when version is bumped.

```R
renv::restore()
```

Run App via:

```R
shiny::runApp()
```

## Development Principles

- Based on analysis ready source data - *ADaM*.

- Accuracy and efficiency first.

- No coding for users. Meet analysis requirement in ADaM procedures not in Shiny Server back-end.

- The output format is Shell. So, no need to draw shell for existing modules.

- Find balance between internal customized format/rules and app performance. (Discuss in demo)

---

<div class="appendix-title-container">
  <div class="appendix-title">Live Demo</div>
</div>

## Released modules

- General Data/Variable Viewer
  - Data Table
  - Variable Browser
- Disposition, Demographic and baseline summary
  - Demographic and baseline Table
  - Disposition Table
- Adverse Events
  - AE Summary
  - AE by SOC & PT
  - AE by SOC & PT & Grade
- Efficacy Analysis
  - Swim Plot
  - Spider Plot
  - Waterfall Plot
  - Kaplan Meier Plot
  - KM Plot (ggsurvfit)
- Laboratory Evaluations
  - Lab Box Plot
  - Labs Summary Table

---

<div class="appendix-title-container">
  <div class="appendix-title">Conclusion</div>
</div>

## Limitation

- Not able to follow internal standard format completely.

- Customized modules are limited in starting stage.

- Lack of support for RTF output format

- Table output relies on `rtables` ecosystem.

## In-plan works

- Testing and Bug fixed

- Validating existing modules compare with SAS

- Training

## Server deployment concept

![](imgs/teal_ssh.png)

## Future development

- More customized modules or use validated `teal.module.clinical` & `teal.module.general` modules for internal outputs.

- Break the limitation of table grammar with `rtables` (like `gtsummary`, `tplyr`)

- More customized functions for output enhancement.
  

# Thanks {.end-slide}

![](assets/logo-end.png){.absolute top="200" left="330" width="400" height="320"}
